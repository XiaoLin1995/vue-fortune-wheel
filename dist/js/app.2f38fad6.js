(function(t){function e(e){for(var i,o,s=e[0],c=e[1],l=e[2],f=0,d=[];f<s.length;f++)o=s[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(d.length)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},a={app:0},r=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"135b":function(t,e,n){"use strict";n("5f5e")},"40e8":function(t,e,n){t.exports=n.p+"img/wheel.1feeccf9.png"},"5a8b":function(t,e,n){},"5f5e":function(t,e,n){},"675d":function(t,e,n){t.exports=n.p+"img/button.7e09e29c.png"},a5c3:function(t,e,n){"use strict";n("d303")},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container",attrs:{id:"app"}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-6"},[i("h2",[t._v(" Canvas ")]),i("FortuneWheel",{staticStyle:{width:"500px","max-width":"100%"},attrs:{verify:t.canvasVerify,canvas:t.canvasOptions,prizes:t.prizesCanvas},on:{rotateStart:t.onCanvasRotateStart,rotateEnd:t.onRotateEnd}})],1),i("div",{staticClass:"col-md-6"},[i("h2",[t._v(" Image ")]),i("FortuneWheel",{staticStyle:{width:"500px","max-width":"100%"},attrs:{type:"image",useWeight:!0,verify:t.canvasVerify,prizeId:t.prizeId,angleBase:-2,prizes:t.prizesImage},on:{rotateStart:t.onImageRotateStart,rotateEnd:t.onRotateEnd}},[i("img",{staticStyle:{transform:"rotateZ(60deg)"},attrs:{slot:"wheel",src:n("40e8")},slot:"wheel"}),i("img",{staticStyle:{width:"180px"},attrs:{slot:"button",src:n("675d")},slot:"button"})]),i("div",{staticClass:"btn-list"},t._l(t.prizesCanvas,(function(e,n){return i("div",{key:n,staticClass:"btn",style:{background:e.bgColor},on:{click:function(n){return t.onChangePrize(e.id)}}})})),0),i("div",{staticClass:"wheel-result"},[t._v(" 当前 100% "),i("span",{style:{background:t.prizeRes.bgColor}}),i("br"),t._v(" 点击按钮，可在旋转中强行改变结果, "),i("br"),t._v(" 最好在旋转减速前, 大约一半的时间之前, 最好一次旋转只改变一次 ")])],1)])])},r=[],o=(n("4de4"),n("d3b7"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fw-container"},[n("div",{staticClass:"fw-wheel",style:t.rotateStyle,on:{transitionend:t.onRotateEnd,webkitTransitionend:t.onRotateEnd}},["canvas"===t.type?n("canvas",{ref:"wheel",attrs:{width:2*t.canvasConfig.radius,height:2*t.canvasConfig.radius}}):t._t("wheel")],2),n("div",{staticClass:"fw-btn"},["canvas"===t.type?n("div",{staticClass:"fw-btn__btn",style:{width:t.canvasConfig.btnWidth+"px",height:t.canvasConfig.btnWidth+"px"},on:{click:t.handleClick}},[t._v(" "+t._s(t.canvasConfig.btnText)+" ")]):n("div",{staticClass:"fw-btn__image",on:{click:t.handleClick}},[t._t("button")],2)])])}),s=[],c=n("2909"),l=(n("5319"),n("ac1f"),n("a9e3"),n("159b"),n("cb29"),n("1276"),n("b0c0"),n("c740"),n("6bd8")),u=n.n(l),f=n("0f40"),d=n.n(f),h={radius:250,textRadius:190,textLength:6,textDirection:"horizontal",lineHeight:20,imageSize:64,borderWidth:0,borderColor:"transparent",btnText:"GO",btnWidth:140,fontSize:34};function p(t,e){var n=[];while(""!==t){var i=t.substr(0,e);t=t.replace(i,""),n.push(i)}return n}var g=i["a"].extend({name:"FortuneWheel",props:{type:{type:String,default:"canvas"},useWeight:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},verify:{type:Boolean,default:!1},canvas:{type:Object,default:function(){return h}},duration:{type:Number,default:6e3},timingFun:{type:String,default:"cubic-bezier(0.36, 0.95, 0.64, 1)"},angleBase:{type:Number,default:10},prizeId:{type:Number,default:0},prizes:{type:Array,required:!0,default:function(){return[]}}},data:function(){return{isRotating:!1,rotateEndDeg:0,prizeRes:{}}},computed:{canvasConfig:function(){return Object.assign(h,this.canvas)},probabilityTotal:function(){return this.useWeight?100:u()(this.prizes,(function(t){return t.probability||0}))},prizesIdArr:function(){var t=this,e=[];return this.prizes.forEach((function(n){var i=t.useWeight?n.weight||0:(n.probability||0)*t.decimalSpaces,a=new Array(i).fill(n.id);e.push.apply(e,Object(c["a"])(a))})),e},decimalSpaces:function(){if(this.useWeight)return 0;var t=Object(c["a"])(this.prizes).sort((function(t,e){var n=String(t.probability).split(".")[1],i=String(e.probability).split(".")[1],a=n?n.length:0,r=i?i.length:0;return r-a})),e=String(t[0].probability).split(".")[1],n=e?e.length:0;return[1,10,100,1e3,1e4][n>4?4:n]},rotateStyle:function(){return{"-webkit-transform":"rotateZ(".concat(this.rotateEndDeg,"deg)"),transform:"rotateZ(".concat(this.rotateEndDeg,"deg)"),"-webkit-transition-duration":"".concat(this.rotateDuration,"s"),"transition-duration":"".concat(this.rotateDuration,"s"),"-webkit-transition-timing-function:":this.timingFun,"transition-timing-function":this.timingFun}},rotateDuration:function(){return this.isRotating?this.duration/1e3:0},rotateBase:function(){var t=360*this.angleBase;return this.angleBase<0&&(t-=360),t},canRotate:function(){return!this.disabled&&!this.isRotating&&100===this.probabilityTotal}},watch:{prizeId:function(t){if(this.isRotating){var e=this.getTargetDeg(t);this.angleBase<0&&(e-=360);var n=this.rotateEndDeg,i=360*this.angleBase+e,a=360*Math.floor((i-n)/360);this.angleBase>=0?i+=Math.abs(a):i+=-360-a,this.rotateEndDeg=i}}},created:function(){this.checkProbability()},mounted:function(){"canvas"===this.type&&this.drawCanvas()},methods:{checkProbability:function(){if(100!==this.probabilityTotal)throw new Error("Prizes Is Error: Sum of probabilities is not 100!");return!0},drawCanvas:function(){var t=this,e=this.$refs.wheel;if(e.getContext){var n=this.canvasConfig,i=n.radius,a=n.textRadius,r=n.borderWidth,o=n.borderColor,s=n.fontSize,c=Math.PI/(this.prizes.length/2),l=e.getContext("2d");l.clearRect(0,0,2*i,2*i),l.strokeStyle=o,l.lineWidth=2*r,l.font="".concat(s,"px Arial"),this.prizes.forEach((function(e,n){var o=n*c-Math.PI/2;l.fillStyle=e.bgColor,l.beginPath(),l.arc(i,i,i-r,o,o+c,!1),l.stroke(),l.arc(i,i,0,o+c,o,!0),l.fill(),l.save(),l.fillStyle=e.color,l.translate(i+Math.cos(o+c/2)*a,i+Math.sin(o+c/2)*a),"image"===e.contentType?t.drawPrizeImage(l,o,c,e.imageUri):t.drawPrizeText(l,o,c,e.name),l.restore()}))}},drawPrizeText:function(t,e,n,i){var a=this.canvasConfig,r=a.lineHeight,o=a.textLength,s=a.textDirection,c=p(i,o);null!==c&&("vertical"===s?t.rotate(e+n/2+Math.PI):t.rotate(e+n/2+Math.PI/2),c.forEach((function(e,n){var i=-t.measureText(e).width/2,a=(n+1)*r;"vertical"===s&&(i=0,a=(n+1)*r-c.length*r/2),t.fillText(e,i,a)})))},drawPrizeImage:function(t,e,n,i){var a=this.canvasConfig.imageSize;t.rotate(e+n/2+Math.PI/2);var r=-a/2,o=-a/2,s=new Image(a,a);s.src=i,t.drawImage(s,r,o,a,a)},handleClick:function(){this.canRotate&&(this.verify?this.$emit("rotateStart",this.onRotateStart):(this.$emit("rotateStart"),this.onRotateStart()))},onRotateStart:function(){this.isRotating=!0;var t=this.prizeId||this.getRandomPrize();this.rotateEndDeg=this.rotateBase+this.getTargetDeg(t)},onRotateEnd:function(){this.isRotating=!1,this.rotateEndDeg%=360,this.$emit("rotateEnd",this.prizeRes)},getRandomPrize:function(){var t=this.prizesIdArr.length,e=this.prizesIdArr[d()(0,t-1)];return e},getTargetDeg:function(t){var e=360/this.prizes.length,n=this.prizes.findIndex((function(e){return e.id===t}));return this.prizeRes=this.prizes[n],360-(e*n+e/2)}}}),v=g,b=(n("a5c3"),n("2877")),y=Object(b["a"])(v,o,s,!1,null,"ed3f6044",null),m=y.exports,w=i["a"].extend({name:"App",components:{FortuneWheel:m},data:function(){return{prizeId:0,canvasVerify:!1,canvasOptions:{btnWidth:140,borderColor:"#584b43",borderWidth:6,lineHeight:30},prizesCanvas:[{id:1,contentType:"text",name:"Blue",value:"Blue's value",bgColor:"#45ace9",color:"#ffffff",probability:30},{id:2,contentType:"text",name:"Red",value:"Red's value",bgColor:"#dd3832",color:"#ffffff",probability:40},{id:3,contentType:"image",imageUri:"https://perperook.ir/img/icons/offers.png",value:"Yellow's value",bgColor:"#fef151",color:"#ffffff",probability:30}],prizesImage:[{id:1,value:"Blue's value",weight:1},{id:2,value:"Red's value",weight:0},{id:3,value:"Yellow's value",weight:0}]}},computed:{prizeRes:function(){var t=this;return this.prizesImage.filter((function(e){return e.id===t.prizeId}))[0]||{}}},methods:{onCanvasRotateStart:function(t){var e=this;if(this.canvasVerify){var n=!0;this.DoServiceVerify(n,2e3).then((function(n){n?(console.log("验证通过, 开始旋转"),t(),e.canvasVerify=!1):alert("未通过验证")}))}else console.log("onCanvasRotateStart")},onImageRotateStart:function(){console.log("onImageRotateStart")},onRotateEnd:function(t){alert(t.value)},onChangePrize:function(t){this.prizeId=t},DoServiceVerify:function(t,e){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}}}),z=w,C=(n("135b"),Object(b["a"])(z,a,r,!1,null,"7a3e74e2",null)),S=C.exports;n("f5df1"),n("5a8b");i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(S)}}).$mount("#app")},d303:function(t,e,n){}});
//# sourceMappingURL=app.2f38fad6.js.map